--[[
 .____                  ________ ___.    _____                           __                
 |    |    __ _______   \_____  \\_ |___/ ____\_ __  ______ ____ _____ _/  |_  ___________ 
 |    |   |  |  \__  \   /   |   \| __ \   __\  |  \/  ___// ___\\__  \\   __\/  _ \_  __ \
 |    |___|  |  // __ \_/    |    \ \_\ \  | |  |  /\___ \\  \___ / __ \|  | (  <_> )  | \/
 |_______ \____/(____  /\_______  /___  /__| |____//____  >\___  >____  /__|  \____/|__|   
         \/          \/         \/    \/                \/     \/     \/                   
          \_Welcome to LuaObfuscator.com   (Alpha 0.2.5) ~  Much Love, Ferib 

]]--

require("stategraphs/commonstates");local v0=require("easing");local v1={ActionHandler(ACTIONS.GOHOME,"action")};local function v2(v3)v3.components.health:SetInvincible(true);v3.force_invincible_value=0;if (v3.physbox==nil) then v3.physbox=SpawnPrefab("wixie_shadow_shield");v3.physbox.Transform:SetPosition(v3.Transform:GetWorldPosition());v3.physbox.entity:AddFollower();v3.physbox.Follower:FollowSymbol(v3.GUID,"swap_body",0,90,0);end end local v5={CommonHandlers.OnLocomote(false,true),EventHandler("attacked",function(v3,v4)if ( not v3.sg:HasStateTag("busy") and v3.components.health:IsDead()) then v3.sg:GoToState("disappear");end end),EventHandler("death",function(v3)if (v3.physbox~=nil) then v3.physbox:Remove();v3.physbox=nil;end if v3.helper then SpawnPrefab("shadow_despawn").Transform:SetPosition(v3.Transform:GetWorldPosition());v3:Remove();else v3.sg:GoToState("death");end end),EventHandler("doattack",function(v3,v4)if  not (v3.sg:HasStateTag("busy") or v3.components.health:IsDead()) then if ((v3.decoy_attack~=nil) and v3.decoy_attack) then v3.sg:GoToState("swap_ammo");elseif ((v3.marble_bag_attack~=nil) and v3.marble_bag_attack) then v3.marble_bag_attack=false;v3.sg:GoToState("throw_marbles",v4.target);elseif ((v3.components.health:GetPercent()<=0.4) and (math.random()<0.5)) then v3.sg:GoToState("cast_charles");elseif v3:IsNear(v4.target,2) then v3.sg:GoToState("attack",v4.target);else if (v3.stunned_count==nil) then v3.stunned_count=0;end v3.stunned_count=v3.stunned_count + 1 ;v3.sg:GoToState("slingshot_shoot");end end end)};local function v6(v3,v7)local v25=v3:GetPosition();local v26,v27,v28=v3.Transform:GetWorldPosition();local v29=SpawnPrefab("shadow_wixie_cloneball");v29.Transform:SetPosition(v25.x,0,v25.z);v25.x=v25.x + math.random( -12,12) ;v25.z=v25.z + math.random( -12,12) ;local v32=v25.x-v26 ;local v33=v25.z-v28 ;local v34=(v32 * v32) + (v33 * v33) ;local v35=TUNING.FIRE_DETECTOR_RANGE * 2 ;local v36=v0.linear(v34,v35,1,v35 * v35 );v29.components.complexprojectile:SetHorizontalSpeed(v36);v29.components.complexprojectile:Launch(v25,v3,v3);v29.caster=v3;if ((v7~=nil) and v7) then v29.thisistheone=true;end end local function v8(v3)local v38,v39,v40=v3.Transform:GetWorldPosition();local v41=SpawnPrefab("dreadeye_sanityburstring");v41:AddTag("ignore_transparency");v41.Transform:SetScale(1.4,1.4,1.4);v41.entity:SetParent(v3.entity);for v65,v66 in ipairs(TheSim:FindEntities(v38,v39,v40,4,{"_combat","player"},{"playerghost"})) do if (v66:IsValid() and (v66.components.combat~=nil) and (v66.components.health~=nil)) then if  not (v66.components.health:IsDead() or v66:HasTag("playerghost")) then v66.components.combat:GetAttacked(v3,50,v3);end end end end local function v9(v3,v10,v11,v12,v13,v14)if ((v3~=nil) and v3:IsValid() and (v11~=nil)) then local v88=SpawnPrefab("slingshot_target");local v89,v90,v91=v3.Transform:GetWorldPosition();local v92=SpawnPrefab("wixie_shadow_shot");v92.Transform:SetPosition(v89,0.5,v91);local v93=(v14 and  -66) or 66 ;local v94=(v14 and 22) or  -22 ;local v95=(v3:GetAngleToPoint(v11,0.5,v13) + v93 + (v94 * (v10-1))) * DEGREES ;v11=v11 + (15 * math.cos(v95)) ;v13=v13-(15 * math.sin(v95)) ;v88.Transform:SetPosition(v11,0.5,v13);v92.components.projectile:Throw(v3,v88,v3);v88:DoTaskInTime(0.1,v88.Remove);end end local function v15(v3,v16)v16.components.combat:GetAttacked(v3,75);v16:PushEvent("knockback",{knocker=v3,radius=20,strengthmult=1.5});if (v3.physbox~=nil) then v3.physbox.AnimState:PlayAnimation("hit");v3.physbox.AnimState:PushAnimation("idle_loop",true);end v16:AddTag("shadowwixie_collision");v16:DoTaskInTime(1,function()v16:RemoveTag("shadowwixie_collision");end);end local v17={"fx","INLIMBO","playerghost","shadowwixie_collision"};local function v18(v3)local v42,v43,v44=v3.Transform:GetWorldPosition();local v45=TheSim:FindEntities(v42,v43,v44,2.9,{"_combat","player"},v17);for v67,v68 in ipairs(v45) do if ((v68~=nil) and v68:IsValid() and (v68.components.health~=nil) and  not v68.components.health:IsDead()) then v3.collided=true;v15(v3,v68);end end end local function v19(v3)if v3:HasTag("prime_shadow_wixie") then v3.components.combat:DropTarget();end end local function v20(v3)local v46=SpawnPrefab("shadow_wixie_helper");v46.Transform:SetPosition(v3.Transform:GetWorldPosition());v46:AddTag("puzzlespawn");v46.Transform:SetRotation(math.random(0,360));local v47=4;for v69=1,v47 do local v70,v71,v72=v3.Transform:GetWorldPosition();local v73=10;v70=(v70 + math.random(2 * v73 )) -v73 ;v72=(v72 + math.random(2 * v73 )) -v73 ;if TheWorld.Map:IsPassableAtPoint(v70,v71,v72) then v46.Transform:SetPosition(v70,v71,v72);break;end end end local v23={State({name="trickster",tags={"busy"},onenter=function(v3,v21)v3.Physics:Stop();v3.decoy_attack=false;v3.AnimState:SetBank("wixie_shadowclone");v3.AnimState:SetBuild("wixie_shadowclone");v3.AnimState:PlayAnimation("pose"   .. math.random(5) ,false);v3.AnimState:SetMultColour(0,0,0,1);v3.components.health:SetInvincible(false);v3.SoundEmitter:PlaySound("UCSounds/shadow_wixie/idle");if (v3.physbox~=nil) then v3.physbox:Remove();v3.physbox=nil;end v3.sg:SetTimeout(15);end,timeline={TimeEvent(7.5,function(v3)v3.SoundEmitter:PlaySound("UCSounds/shadow_wixie/idle");end)},onexit=function(v3)v3.AnimState:SetMultColour(0,0,0,0.6);v3.AnimState:SetBank("wilson");v3.AnimState:SetBuild("wixie");end,ontimeout=function(v3)v3.sg:GoToState("disappear");end}),State({name="idle",tags={"idle","canrotate"},onenter=function(v3,v21)v3.Physics:Stop();v3.AnimState:PlayAnimation("idle_loop",true);end}),State({name="laugh_at_you",tags={"busy"},onenter=function(v3,v21)v3.Physics:Stop();v3.AnimState:PlayAnimation("emote_laugh");v3.SoundEmitter:PlaySound("UCSounds/shadow_wixie/laugh");end,events={EventHandler("animover",function(v3)if v3.AnimState:AnimDone() then v3.sg:GoToState("idle");end end)}}),State({name="attack",tags={"attack","abouttoattack","busy"},onenter=function(v3,v16)v3.components.locomotor:Stop();v3.AnimState:PlayAnimation("punch");v3.SoundEmitter:PlaySound("dontstarve/wilson/attack_nightsword");v3.components.combat:StartAttack();if (v16==nil) then v16=v3.components.combat.target;end if ((v16~=nil) and v16:IsValid()) then v3.sg.statemem.target=v16;v3:ForceFacePoint(v16.Transform:GetWorldPosition());end end,timeline={TimeEvent(8 * FRAMES ,function(v3)v3.sg:RemoveStateTag("abouttoattack");local v49=v3.sg.statemem.target;if v49:HasTag("creatureknockbackable") then v49:PushEvent("knockback",{knocker=v3,radius=20,strengthmult=1});else v49:PushEvent("knockback",{knocker=v3,radius=20,strengthmult=1});end end),TimeEvent(12 * FRAMES ,function(v3)v3.sg:RemoveStateTag("busy");end),TimeEvent(13 * FRAMES ,function(v3)v3.sg:RemoveStateTag("attack");end)},events={EventHandler("animqueueover",function(v3)if v3.AnimState:AnimDone() then v3.sg:GoToState("idle");end end)},onexit=function(v3)v19(v3);if v3.sg:HasStateTag("abouttoattack") then v3.components.combat:CancelAttack();end end}),State({name="cast_charles",tags={"doing","busy","canrotate"},onenter=function(v3)if (v3.components.playercontroller~=nil) then v3.components.playercontroller:Enable(false);end v3.AnimState:OverrideSymbol("swap_object","swap_charles_shadow","swap_charles_shadow");v3.AnimState:PlayAnimation("staff_pre");v3.AnimState:PushAnimation("staff",false);v3.components.locomotor:Stop();v3.sg:SetTimeout(1.8);end,timeline={TimeEvent(13 * FRAMES ,function(v3)v3.SoundEmitter:PlaySound("dontstarve/creatures/knight_nightmare/voice");end)},ontimeout=function(v3)v3.sg:GoToState("charles_charge_pre");end,events={EventHandler("animqueueover",function(v3)if v3.AnimState:AnimDone() then v3.sg:GoToState("charles_charge_pre");end end)}}),State({name="charles_charge_pre",tags={"busy"},onenter=function(v3,v21)v3.AnimState:PlayAnimation("spearjab_pre");end,events={EventHandler("animover",function(v3)if v3.AnimState:AnimDone() then v3.sg:GoToState("charles_charge");end end)}}),State({name="charles_charge",tags={"moving","running","canrotate","busy"},onenter=function(v3)v3.components.locomotor:Stop();if (v3.charge_count==nil) then v3.charge_count=1;else v3.charge_count=v3.charge_count + 1 ;end local v50=v3.components.combat.target;if ((v50~=nil) and v50:IsValid()) then v3:ForceFacePoint(v50.Transform:GetWorldPosition());end v3.AnimState:PlayAnimation("spearjab");v3.sg.statemem.start_bowling=false;end,onupdate=function(v3)if v3.sg.statemem.start_bowling then v3.components.locomotor:RunForward();end end,timeline={TimeEvent(1 * FRAMES ,function(v3)v3.SoundEmitter:PlaySound("dontstarve/creatures/knight_nightmare/attack");v3.components.locomotor:WalkForward();v3.sg.statemem.start_bowling=true;v18(v3);end),TimeEvent(8 * FRAMES ,function(v3)v18(v3);end),TimeEvent(18 * FRAMES ,function(v3)v18(v3);end),TimeEvent(28 * FRAMES ,function(v3)v18(v3);end)},events={EventHandler("animover",function(v3)if (v3.charge_count>=5) then v3.charge_count=nil;v3.collided=nil;v3.AnimState:OverrideSymbol("swap_object","swap_slingshot","swap_slingshot");v3.sg:GoToState("claustrophobia");elseif (v3.collided~=nil) then v3.collided=nil;v19(v3);v3.sg:GoToState("laugh_at_you");else v3.sg:GoToState("charles_charge");end end)}}),State({name="slingshot_shoot",tags={"attack","abouttoattack"},onenter=function(v3)v3.AnimState:OverrideSymbol("swap_object","swap_slingshot","swap_slingshot");local v53=v3:GetBufferedAction();local v54=v3.components.combat.target;if ((v54~=nil) and v54:IsValid()) then v3:ForceFacePoint(v54.Transform:GetWorldPosition());end v3.AnimState:PlayAnimation("slingshot_pre");v3.AnimState:PushAnimation("slingshot",false);v3.components.combat:StartAttack();v3.components.locomotor:Stop();end,timeline={TimeEvent(19 * FRAMES ,function(v3)v3.SoundEmitter:PlaySound("dontstarve/characters/walter/slingshot/stretch");end),TimeEvent(24 * FRAMES ,function(v3)local v55=v3.components.combat.target;if (v55~=nil) then local v103,v104,v105=v55.Transform:GetWorldPosition();local v106=false;if (math.random()>0.5) then v106=true;end v8(v3);for v116=1,7 do v3:DoTaskInTime(0.05 * v116 ,function()v9(v3,v116,v103,v104,v105,v106);end);end end v3:PerformBufferedAction();v3.sg:RemoveStateTag("abouttoattack");v3.SoundEmitter:PlaySound("dontstarve/characters/walter/slingshot/shoot");end)},events={EventHandler("animqueueover",function(v3)if v3.AnimState:AnimDone() then if v3.helper then if (v3.stunned_count>=3) then v3.stunned_count=0;v3.sg:GoToState("claustrophobia");else v3.sg:GoToState("idle");end else local v119=6 -((15 * v3.components.health:GetPercent())/3) ;if (v3.multisling==nil) then v3.multisling=1;end v3.multisling=v3.multisling + 1 ;if (v3.multisling<=v119) then v3.sg:GoToState("slingshot_shoot");else v3.multisling=nil;if (v3.stunned_count>=3) then v3.stunned_count=0;v3.sg:GoToState("claustrophobia");else v19(v3);v3.sg:GoToState("idle");end end end end end)},onexit=function(v3)if v3.sg:HasStateTag("abouttoattack") then v3.components.combat:CancelAttack();end end}),State({name="swap_ammo",tags={"busy"},onenter=function(v3)v3.Physics:Stop();v3.AnimState:PlayAnimation("cointoss_pre");v3.AnimState:PushAnimation("cointoss",false);v3.SoundEmitter:PlaySound("UCSounds/shadow_wixie/taunt");v3.decoy_attack_count=0;end,timeline={TimeEvent(12 * FRAMES ,function(v3)local v57=math.random(1,15);for v74=1,15 do v3:DoTaskInTime(v74/40 ,function(v75)if (v57==v74) then v6(v75,true);else v6(v75,false);end end);end end),TimeEvent(53 * FRAMES ,function(v3)v3:PerformBufferedAction();end),TimeEvent(70 * FRAMES ,function(v3)v3.sg:GoToState("idle",true);end)},events={EventHandler("animqueueover",function(v3)if v3.AnimState:AnimDone() then v3.sg:GoToState("idle");end end)}}),State({name="taunt",tags={"busy"},onenter=function(v3)v3.Physics:Stop();v3.AnimState:PlayAnimation("idle_wixie");v3.SoundEmitter:PlaySound("UCSounds/shadow_wixie/taunt");end,events={EventHandler("animover",function(v3)v3.sg:GoToState("idle");end)}}),State({name="death",tags={"busy"},onenter=function(v3)v3.Physics:Stop();v3.AnimState:Hide("swap_arm_carry");v3.AnimState:PlayAnimation("death");v3.components.colourtweener:StartTween({1,1,1,1},2.5,nil,true);v3.AnimState:ShowSymbol("face");local v58=SpawnPrefab("wixie_piano_card");v58.Transform:SetPosition(v3.Transform:GetWorldPosition());v58.name="Omnia bona finiri debent";Launch2(v58,v3,2,0,1,0.5);end,events={EventHandler("animover",function(v3)v3:DoTaskInTime(1,function()local v76,v77,v78=v3.Transform:GetWorldPosition();local v79=FindPlayersInRange(v76,v77,v78,40,true);for v107,v108 in ipairs(v79) do if ((v108~=nil) and v108:IsValid()) then local v121=SpawnPrefab("archive_lockbox_player_fx");if (v121~=nil) then v108:AddChild(v121);end v108.components.builder:UnlockRecipe("the_real_charles_t_horse");if v108:HasTag("troublemaker") then v108.components.builder:UnlockRecipe("slingshotammo_shadow");end if v108.components.talker then v108.components.talker:Say(GetString(v108,"ANNOUNCE_ARCHIVE_NEW_KNOWLEDGE"),nil,true);end Launch2(SpawnPrefab("nightmarefuel"),v3,1.5,1,3,0.75);end end v3.components.lootdropper:DropLoot();SpawnPrefab("statue_transition").Transform:SetPosition(v76,v77,v78);SpawnPrefab("statue_transition_2").Transform:SetPosition(v76,v77,v78);v3.SoundEmitter:PlaySound("dontstarve/maxwell/shadowmax_despawn");v3:Remove();end);end)}}),State({name="disappear",tags={"busy","noattack"},onenter=function(v3)v2(v3);v3.AnimState:PlayAnimation("wortox_portal_jumpin");SpawnPrefab("cavehole_flick_warn").Transform:SetPosition(v3.Transform:GetWorldPosition());v3.SoundEmitter:PlaySound("UCSounds/shadow_wixie/appear");v3.Physics:Stop();v3:AddTag("NOCLICK");end,events={EventHandler("animover",function(v3)local v60=4;for v80=1,v60 do local v81,v82,v83=v3.Transform:GetWorldPosition();local v84=12;v81=(v81 + math.random(2 * v84 )) -v84 ;v83=(v83 + math.random(2 * v84 )) -v84 ;if TheWorld.Map:IsPassableAtPoint(v81,v82,v83) then v3.Physics:Teleport(v81,v82,v83);break;end end v3.sg:GoToState("appear");end)}}),State({name="appear",tags={"busy"},onenter=function(v3)v3.components.locomotor:Stop();if  not v3.helper then local v109,v110,v111=v3.Transform:GetWorldPosition();local v112=FindPlayersInRange(v109,v110,v111,40,true);for v117=1,( #v112/2) -0.5  do v20(v3);end end SpawnPrefab("cavehole_flick").Transform:SetPosition(v3.Transform:GetWorldPosition());v2(v3);v3.AnimState:PlayAnimation("jumpout");v3.SoundEmitter:PlaySound("UCSounds/shadow_wixie/appear");end,timeline={TimeEvent(2 * FRAMES ,function(v3)v3.Physics:SetMotorVelOverride(4,0,0);end),TimeEvent(20 * FRAMES ,function(v3)v3.Physics:ClearMotorVelOverride();v3.components.locomotor:Stop();end)},events={EventHandler("animover",function(v3)v3.sg:GoToState("idle");end)},onexit=function(v3)v3:RemoveTag("NOCLICK");end}),State({name="action",onenter=function(v3,v22)v3.Physics:Stop();v3:PerformBufferedAction();end,events={EventHandler("animover",function(v3)v3.sg:GoToState("idle");end)}}),State({name="claustrophobia",tags={"busy"},onenter=function(v3)v3.components.locomotor:Stop();v3.AnimState:PlayAnimation("mindcontrol_pre");v3.AnimState:PushAnimation("mindcontrol_loop",true);v3.components.health:SetInvincible(false);v3.charge_count=nil;v3.stunned_count=0;if (v3.physbox~=nil) then v3.physbox.AnimState:PlayAnimation("close");v3.physbox:DoTaskInTime(0.3,v3.physbox.Remove);v3.physbox=nil;end v3.sg:SetTimeout((v3.helper and 8) or 5 );end,ontimeout=function(v3)v3.sg:GoToState("claustrophobia_pst");end}),State({name="claustrophobia_pst",tags={"busy"},onenter=function(v3)v2(v3);v3.AnimState:PlayAnimation("mindcontrol_pst");end,events={EventHandler("animover",function(v3)if v3.AnimState:AnimDone() then v19(v3);v3.sg:GoToState("disappear");end end)}}),State({name="throw_marbles",tags={"busy"},onenter=function(v3,v16)v3.components.locomotor:Stop();v3.AnimState:OverrideSymbol("swap_object","swap_marblebag","swap_sleepbomb");v3.AnimState:PlayAnimation("throw");if ((v16~=nil) and v16:IsValid()) then v3:FacePoint(v16.Transform:GetWorldPosition());v3.sg.statemem.target=v16;end end,timeline={TimeEvent(7 * FRAMES ,function(v3)local v63=v3.sg.statemem.target:GetPosition();local v64=SpawnPrefab("bagofwarbles");v64.Transform:SetPosition(v3.Transform:GetWorldPosition());v64.components.complexprojectile:Launch(v63,v3,v3);v64.AnimState:SetMultColour(0,0,0,0.6);v3:ClearBufferedAction();v3.sg:RemoveStateTag("abouttoattack");v3.AnimState:OverrideSymbol("swap_object","swap_slingshot","swap_slingshot");end)},events={EventHandler("animover",function(v3)if v3.AnimState:AnimDone() then v19(v3);v3.sg:GoToState("idle");end end)}})};CommonStates.AddWalkStates(v23);return StateGraph("shadow_wixie",v23,v5,"appear",v1);